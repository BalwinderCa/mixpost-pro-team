import{N as W,I as P,Y as L,o as n,g as $,w as e,a as t,A as Y,e as k,c as v,t as l,h as _,b as s,am as Z,f as r,F as I,r as O,H as K,S as q,ag as Q,a6 as X,af as ee,ab as te,R as z,u as se,aG as ae,J as le,cb as S,ad as oe,ae as T,l as B,ak as U,cl as ie,m as ne,Z as re,aB as j,U as ue,bw as ce,n as de}from"./app.02c7459f.js";import{u as me}from"./useSelectable.e932508a.js";import{_ as fe}from"./PageHeader.ca32a0c2.js";import{_ as N,a as pe}from"./PostsFilter.5e838ab0.js";import{T as ve,_ as V}from"./Tab.203b4d79.js";import{_ as _e}from"./Panel.30e9fcce.js";import{_ as F}from"./Checkbox.52b731a7.js";import{_ as m,a as E,T as he}from"./TableCell.dcaa8136.js";import{_ as ge}from"./PureDangerButton.35baf161.js";import{u as ke}from"./usePostVersions.8b3eb955.js";import{_ as $e}from"./MediaFile.9ef1dcdd.js";import{u as xe,_ as M,c as be,b as we,a as ye}from"./VerticallyScrollableContent.c7cf0053.js";import{_ as A}from"./Account.4ad97c7e.js";import{_ as Ce}from"./SelectableBar.7f85b4bf.js";import{_ as Ve}from"./Pagination.5a4c3250.js";import{_ as Ie}from"./NoResult.90dab0cf.js";import{T as De}from"./Trash.4a91c762.js";import"./Flex.d1bb12d6.js";import"./PureButtonLink.778d599f.js";import"./EllipsisVertical.b7e378de.js";import"./ProviderIcon.ede0b558.js";import"./SearchInput.9560fa3a.js";import"./ExclamationCircle.70f35379.js";import"./Variable.0eaa09f3.js";import"./index.ca3912e7.js";import"./EditorReadOnly.fa523d1b.js";import"./Alert.e0955a42.js";import"./Refresh.d1d5f060.js";import"./ArrowTopRightOnSquare.459d61de.js";import"./ColorPicker.162c0fab.js";import"./ChevronLeft.9c963410.js";const Oe={class:"w-44"},Re={key:0,class:"text-sm mt-xs text-gray-500"},Be={key:1,class:"text-sm mt-xs text-gray-500"},Pe={class:"w-96 text-left break-words"},Se={key:0,class:"w-48 flex relative"},Te={key:0,class:"absolute top-0 -right-5 z-10"},Ue={class:"flex flex-wrap gap-xs"},je={class:"flex gap-xs"},Ne={class:"mr-xs"},Fe={class:"text-left"},Me={class:"mr-xs flex items-center"},Ae={__name:"PostItem",props:{item:{type:Object,required:!0},filter:{type:Object,default:{accounts:[]}}},setup(a){const d=a,{getOriginalVersion:o,getAccountVersion:f}=ke(),{setupURLMetaForAllVersions:R}=xe(),p=W(()=>{if(!d.item.versions.length)return{excerpt:"",media:null,media_count:0};let x=d.item.accounts;d.filter.accounts.length&&(x=x.filter(u=>d.filter.accounts.includes(u.id)));const C=x.map(u=>{const h=f(d.item.versions,u.id);return h?h.content[0]:o(d.item.versions).content[0]}),b=C.length?C[0]:d.item.versions[0].content[0];return{excerpt:b.excerpt,media:b.media.length?b.media[0]:null,media_count:b.media.length}}),w=P(!1),y=()=>{w.value=!0,R(d.item.versions)},D=()=>{w.value=!1};return(x,C)=>{const b=L("tooltip");return n(),$(E,{hoverable:!0},{default:e(()=>[t(m,{class:"w-10"},{default:e(()=>[Y(x.$slots,"checkbox")]),_:3}),t(m,{clickable:!0,onClick:y},{default:e(()=>[k("div",Oe,[t(M,{value:a.item.status},null,8,["value"]),a.item.status==="scheduled"?(n(),v("div",Re,l(a.item.scheduled_at.human),1)):_("",!0),a.item.status==="published"?(n(),v("div",Be,l(a.item.published_at.human),1)):_("",!0)])]),_:1}),t(m,{clickable:!0,onClick:y,class:"!pl-0"},{default:e(()=>[k("div",Pe,l(s(p).excerpt),1)]),_:1}),t(m,{clickable:!0,onClick:y},{default:e(()=>[s(p).media?(n(),v("div",Se,[s(p).media?(n(),$($e,{key:0,media:s(p).media,"img-height":"sm",imgWidthFull:!1},{default:e(()=>[s(p).media_count>1?(n(),v("div",Te,[t(Z,null,{default:e(()=>[r("+"+l(s(p).media_count-1),1)]),_:1})])):_("",!0)]),_:1},8,["media"])):_("",!0)])):_("",!0)]),_:1}),t(m,{clickable:!0,onClick:y},{default:e(()=>[k("div",Ue,[(n(!0),v(I,null,O(a.item.tags,u=>(n(),$(be,{key:u.id,item:u,removable:!1,editable:!1},null,8,["item"]))),128))])]),_:1}),t(m,null,{default:e(()=>[k("div",je,[(n(!0),v(I,null,O(a.item.accounts.slice(0,3),(u,h)=>(n(),v("div",{key:u.id,class:K({"-ml-6":h>0})},[q(t(A,{provider:u.provider,name:u.name,"img-url":u.image,active:!0},null,8,["provider","name","img-url"]),[[b,u.name]])],2))),128)),a.item.accounts.length>3?(n(),$(Q,{key:0,"width-classes":"w-64",placement:"bottom-end"},{trigger:e(()=>[t(X,{class:"mt-4 font-semibold"},{default:e(()=>[r("+"+l(a.item.accounts.slice(3).length),1)]),_:1})]),content:e(()=>[t(we,null,{default:e(()=>[(n(!0),v(I,null,O(a.item.accounts.slice(3),u=>(n(),$(ee,{as:"div"},{default:e(()=>[k("span",Ne,[t(A,{provider:u.provider,name:u.name,"img-url":u.image,active:!0},null,8,["provider","name","img-url"])]),k("span",Fe,l(u.name),1)]),_:2},1024))),256))]),_:1})]),_:1})):_("",!0)])]),_:1}),t(m,null,{default:e(()=>[r(l(a.item.user.name),1)]),_:1}),t(m,null,{default:e(()=>[t(N,{itemId:a.item.id,trashed:a.item.trashed},null,8,["itemId","trashed"])]),_:1}),t(te,{show:w.value,scrollableBody:!0,onClose:D},{body:e(()=>[t(M,{value:a.item.status,class:"mb-lg"},null,8,["value"]),w.value?(n(),$(ye,{key:0,accounts:a.item.accounts,versions:a.item.versions},null,8,["accounts","versions"])):_("",!0)]),footer:e(()=>[w.value?(n(),v(I,{key:0},[k("div",Me,[t(N,{itemId:a.item.id,trashed:a.item.trashed},null,8,["itemId","trashed"])]),t(z,{onClick:D},{default:e(()=>[r(l(x.$t("general.close")),1)]),_:1})],64)):_("",!0)]),_:1},8,["show"])]),_:3})}}},Le={class:"row-py"},qe={class:"w-full row-px"},ze={class:"w-full row-px mt-lg"},Ee={key:0,class:"mt-lg"},bt={__name:"Index",props:{filter:{type:Object,default:{}},posts:{type:Object},has_failed_posts:{type:Boolean,default:!1}},setup(a){const d=a,{t:o}=se(),f=P({keyword:d.filter.keyword,status:d.filter.status,tags:d.filter.tags,accounts:d.filter.accounts}),R=ae({urlMeta:{}});ce("postCtx",R);const{selectedRecords:p,putPageRecords:w,toggleSelectRecordsOnPage:y,deselectRecord:D,deselectAllRecords:x}=me(),C=ne("workspaceCtx"),b=()=>d.posts.data.map(g=>g.id);le(()=>{w(b()),S.on("postDelete",g=>{D(g)})}),oe(()=>{S.off("postDelete")}),T(()=>B.exports.cloneDeep(f.value),B.exports.throttle(()=>{U.get(route("mixpost.posts.index",{workspace:C.id}),B.exports.pickBy(f.value),{preserveState:!0,only:["posts","filter"]})},300)),T(()=>d.posts.data,()=>{w(b())});const{notify:u}=de(),h=P(!1),G=()=>{U.delete(route("mixpost.posts.deleteMultiple",{workspace:C.id}),{data:{posts:p.value,status:f.value.status},onSuccess(){x(),u("success",d.filter.status==="trash"?o("post.posts_deleted"):o("post.posts_to_trash"))},onFinish(){h.value=!1}})};return(g,i)=>{const H=L("tooltip");return n(),v(I,null,[t(s(re),{title:s(o)("post.posts")},null,8,["title"]),k("div",Le,[t(fe,{title:s(o)("post.posts")},{default:e(()=>[t(pe,{modelValue:f.value,"onUpdate:modelValue":i[0]||(i[0]=c=>f.value=c),class:"md:ml-xs rtl:md:ml-0 rtl:md:mr-xs"},null,8,["modelValue"])]),_:1},8,["title"]),k("div",qe,[t(ve,null,{default:e(()=>[t(V,{onClick:i[1]||(i[1]=c=>f.value.status=null),active:!g.$page.props.filter.status},{default:e(()=>[r(l(s(o)("general.all")),1)]),_:1},8,["active"]),t(V,{onClick:i[2]||(i[2]=c=>f.value.status="draft"),active:g.$page.props.filter.status==="draft"},{default:e(()=>[r(l(s(o)("post.drafts")),1)]),_:1},8,["active"]),t(V,{onClick:i[3]||(i[3]=c=>f.value.status="scheduled"),active:g.$page.props.filter.status==="scheduled"},{default:e(()=>[r(l(s(o)("post.scheduled")),1)]),_:1},8,["active"]),t(V,{onClick:i[4]||(i[4]=c=>f.value.status="published"),active:g.$page.props.filter.status==="published"},{default:e(()=>[r(l(s(o)("post.published")),1)]),_:1},8,["active"]),a.has_failed_posts?(n(),$(V,{key:0,onClick:i[5]||(i[5]=c=>f.value.status="failed"),active:g.$page.props.filter.status==="failed",class:"text-red-500"},{default:e(()=>[r(l(s(o)("post.failed")),1)]),_:1},8,["active"])):_("",!0),t(V,{onClick:i[6]||(i[6]=c=>f.value.status="trash"),active:g.$page.props.filter.status==="trash"},{default:e(()=>[r(l(s(o)("general.trash")),1)]),_:1},8,["active"])]),_:1})]),k("div",ze,[t(Ce,{count:s(p).length,onClose:s(x)},{default:e(()=>[q((n(),$(ge,{onClick:i[7]||(i[7]=c=>h.value=!0)},{default:e(()=>[t(De)]),_:1})),[[H,s(o)("general.delete")]])]),_:1},8,["count","onClose"]),t(_e,{"with-padding":!1},{default:e(()=>[t(he,null,{head:e(()=>[t(E,null,{default:e(()=>[t(m,{component:"th",scope:"col",class:"w-10"},{default:e(()=>[t(F,{checked:s(y),"onUpdate:checked":i[8]||(i[8]=c=>j(y)?y.value=c:null),disabled:!a.posts.meta.total},null,8,["checked","disabled"])]),_:1}),t(m,{component:"th",scope:"col",class:"w-44"},{default:e(()=>[r(l(s(o)("post.status")),1)]),_:1}),t(m,{component:"th",scope:"col",class:"!pl-0 text-left"},{default:e(()=>[r(l(s(o)("post.content")),1)]),_:1}),t(m,{component:"th",scope:"col",class:"w-48"},{default:e(()=>[r(l(s(o)("post.media")),1)]),_:1}),t(m,{component:"th",scope:"col"},{default:e(()=>[r(l(s(o)("post.labels")),1)]),_:1}),t(m,{component:"th",scope:"col"},{default:e(()=>[r(l(s(o)("post.accounts")),1)]),_:1}),t(m,{component:"th",scope:"col"},{default:e(()=>[r(l(s(o)("post.author")),1)]),_:1}),t(m,{component:"th",scope:"col"})]),_:1})]),body:e(()=>[(n(!0),v(I,null,O(a.posts.data,c=>(n(),$(Ae,{key:c.id,item:c,filter:a.posts.filter,onOnDelete:()=>{s(D)(c.id)}},{checkbox:e(()=>[t(F,{checked:s(p),"onUpdate:checked":i[9]||(i[9]=J=>j(p)?p.value=J:null),value:c.id},null,8,["checked","value"])]),_:2},1032,["item","filter","onOnDelete"]))),128))]),_:1}),a.posts.meta.total?_("",!0):(n(),$(Ie,{key:0,class:"py-md px-md"},{default:e(()=>[r(l(s(o)("post.no_posts_found")),1)]),_:1}))]),_:1}),a.posts.meta.links.length>3?(n(),v("div",Ee,[t(Ve,{meta:a.posts.meta,links:a.posts.links},null,8,["meta","links"])])):_("",!0)])]),t(ie,{show:h.value,variant:"danger",onClose:i[11]||(i[11]=c=>h.value=!1)},{header:e(()=>[r(l(s(o)("post.delete_posts")),1)]),body:e(()=>[r(l(s(o)("post.confirmation_delete_post")),1)]),footer:e(()=>[t(z,{onClick:i[10]||(i[10]=c=>h.value=!1),class:"mr-xs rtl:mr-0 rtl:ml-xs"},{default:e(()=>[r(l(s(o)("general.cancel")),1)]),_:1}),t(ue,{onClick:G},{default:e(()=>[r(l(s(o)("general.delete")),1)]),_:1})]),_:1},8,["show"])],64)}}};export{bt as default};
